{"version":3,"file":"LoggerBuilder.js","names":["LoggerBuilder","factory","context","level","window","hasOwnProperty","OC","config","loglevel","undefined","LogLevel","Warn","debug","Debug","appId","app","uid","user","getCurrentUser"],"sources":["../lib/LoggerBuilder.ts"],"sourcesContent":["/// <reference types=\"@nextcloud/typings\" />\n\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { ILogger, ILoggerFactory, LogLevel } from './contracts'\n\ndeclare var OC: Nextcloud.v22.OC | Nextcloud.v23.OC | Nextcloud.v24.OC;\n\nexport class LoggerBuilder {\n\n    private context: any\n\n    private factory: ILoggerFactory\n\n    constructor(factory: ILoggerFactory) {\n        this.context = {}\n        this.factory = factory\n        // Up to, including, nextcloud 24 the loglevel was not exposed\n        this.context.level = (window.hasOwnProperty('OC') && OC?.config?.loglevel !== undefined) ? OC.config.loglevel : LogLevel.Warn\n        // Override loglevel if we are in debug mode\n        if (window.hasOwnProperty('OC') && OC?.debug) {\n            this.context.level = LogLevel.Debug\n        }\n    }\n\n    setApp(appId: string): LoggerBuilder {\n        this.context.app = appId\n        return this\n    }\n\n    setLogLevel(level: LogLevel) {\n        this.context.level = level\n        return this\n    }\n\n    setUid(uid: string): LoggerBuilder {\n        this.context.uid = uid\n        return this\n    }\n\n    detectUser(): LoggerBuilder {\n        const user = getCurrentUser()\n        if (user !== null) {\n            this.context.uid = user.uid\n        }\n\n        return this\n    }\n\n    build(): ILogger {\n        return this.factory(this.context)\n    }\n\n}\n"],"mappings":";;;;;;;;;AAEA;;AACA;;;;;;;;;;IAIaA,a;EAMT,uBAAYC,OAAZ,EAAqC;IAAA;;IAAA;;IAAA;;IAAA;;IACjC,KAAKC,OAAL,GAAe,EAAf;IACA,KAAKD,OAAL,GAAeA,OAAf,CAFiC,CAGjC;;IACA,KAAKC,OAAL,CAAaC,KAAb,GAAsBC,MAAM,CAACC,cAAP,CAAsB,IAAtB,KAA+B,QAAAC,EAAE,UAAF,gDAAIC,MAAJ,0DAAYC,QAAZ,MAAyBC,SAAzD,GAAsEH,EAAE,CAACC,MAAH,CAAUC,QAAhF,GAA2FE,mBAAA,CAASC,IAAzH,CAJiC,CAKjC;;IACA,IAAIP,MAAM,CAACC,cAAP,CAAsB,IAAtB,aAA+BC,EAA/B,iCAA+B,KAAIM,KAAvC,EAA8C;MAC1C,KAAKV,OAAL,CAAaC,KAAb,GAAqBO,mBAAA,CAASG,KAA9B;IACH;EACJ;;;;WAED,gBAAOC,KAAP,EAAqC;MACjC,KAAKZ,OAAL,CAAaa,GAAb,GAAmBD,KAAnB;MACA,OAAO,IAAP;IACH;;;WAED,qBAAYX,KAAZ,EAA6B;MACzB,KAAKD,OAAL,CAAaC,KAAb,GAAqBA,KAArB;MACA,OAAO,IAAP;IACH;;;WAED,gBAAOa,GAAP,EAAmC;MAC/B,KAAKd,OAAL,CAAac,GAAb,GAAmBA,GAAnB;MACA,OAAO,IAAP;IACH;;;WAED,sBAA4B;MACxB,IAAMC,IAAI,GAAG,IAAAC,oBAAA,GAAb;;MACA,IAAID,IAAI,KAAK,IAAb,EAAmB;QACf,KAAKf,OAAL,CAAac,GAAb,GAAmBC,IAAI,CAACD,GAAxB;MACH;;MAED,OAAO,IAAP;IACH;;;WAED,iBAAiB;MACb,OAAO,KAAKf,OAAL,CAAa,KAAKC,OAAlB,CAAP;IACH"}